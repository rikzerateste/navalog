import React, { useState, useEffect } from "react";
import { InputText } from "primereact/inputtext";
import axios from "axios";
import styles from "./styles.module.scss";
import PrimeButton from "../button/index";
import Button from "../button/index";
import Image from "next/image";
import ListaPassageirosIcon from '../../../public/images/ListaDePassageiros-Icon.svg'
import { Dropdown, DropdownChangeEvent } from "primereact/dropdown";
import { ProgressSpinner } from "primereact/progressspinner";
import { IconField } from "primereact/iconfield";
import { InputIcon } from "primereact/inputicon";
import { DataTable } from "primereact/datatable";
import { Column } from "primereact/column";
import { ToastContainer, toast } from "react-toastify";
import "react-toastify/dist/ReactToastify.css";
import { componentsToColor } from "pdf-lib";
import { Dialog } from "primereact/dialog";
import ButtonCustom from "../../../components/portal/button";
import { headers } from "next/headers";

interface LPE {
  Controle?: number;
  Companhia_Agente?: string;
  Embarcacao: string;
  embarcacao?: Embarcacao;
  Porto_de_chegada_e_partida?: string;
  Porto_de_procedencia?: string;
  Data_emissao?: string;
  Lpe_obs1?: string;
  Comandante?: string;
  lped?: LPED[];
  lpecomboio?: LPEComboio[];
}
// Tirar Lista de Comboio
interface LPEComboio {
  Controle?: number;
  Lista?: number;
  Embarcacao: string;
  embarcacao?: Embarcacao;
}

interface LPED {
  Controle?: number;
  Lista?: number;
  Documento?: string;
  Identificacao?: string;
  Nome?: string;
  pessoal: Pessoal;
}

interface Empresa {
  Codigo: number;
  Empresa: string;
}

interface Embarcacao {
  Inscricao?: string;
  Embarcacao?: string;
  Empresa?: Empresa;
  lpe?: LPE[];
  lpecomboio?: LPEComboio[];
}

interface Tripulante {
  Documento: string;
  Nome: string;
}

interface Pessoal {
  Controle?: number;
  Documento: string;
  Nome: String;
  Funcao?: String;
  Data_de_nascimento?: String;
  Nacionalidade?: number;
  RG?: String;
  lped?: LPED[];
}

interface ModalCadastroEdicaoProps {
  onClose: () => void;
  onSuccess: () => void;
  passageiro?: LPE | null;
}

const ModalCadastroEdicao: React.FC<ModalCadastroEdicaoProps> = ({
  onClose,
  onSuccess,
  passageiro,
}) => {
  const [lpe, setLpe] = useState<LPE>({
    Controle: 0,
    Embarcacao: "",
    Companhia_Agente: "",
    embarcacao: {
      Inscricao: "",
      Embarcacao: "",
      Empresa: {
        Codigo: 0,
        Empresa: "",
      },
    },
    Porto_de_chegada_e_partida: "",
    Porto_de_procedencia: "",
    Data_emissao: "",
    Lpe_obs1: "",
    Comandante: "",
  });
  const [novoLPED, setNovoLPED] = useState<LPED>({
    Controle: 0,
    Lista: 0,
    Documento: "",
    Identificacao: "",
    pessoal: {
      Documento: "",
      Nome: "",
    },
  });
  const [embarcacoes, setEmbarcacoes] = useState<Embarcacao[]>([]);
  const [embarcacoesComboio, setEmbarcacoesComboio] = useState<Embarcacao[]>(
    []
  );
  const [embarcacaoSelecionada, setEmbarcacaoSelecionada] =
    useState<Embarcacao | null>(null); // Alterado para LPED | null

  const [tripulantes, setTripulantes] = useState<Pessoal[]>([]);
  const [tripulanteSelecionado, setTripulanteSelecionado] =
    useState<Pessoal | null>(null); // Alterado para LPED | null

  const [lpeComboio, setLpeComboio] = useState<LPEComboio>({
    Controle: 0,
    Embarcacao: "",
    Lista: 0,
    embarcacao: {
      Inscricao: "",
      Embarcacao: "",
      Empresa: {
        Codigo: 0,
        Empresa: "",
      },
    },
  });

  // Estado inicial de `lpeComboios`
  const [lpeComboios, setLpeComboios] = useState<LPEComboio[]>([]);

  const [lpeComboiosEdit, setLpeComboiosEdit] = useState<LPEComboio[]>([]);

  const [lpedsEdit, setLpedsEdit] = useState<LPED[]>([]);

  const [lpeds, setLpeds] = useState<LPED[]>([]);
  const [lped, setLped] = useState<LPED>({
    Controle: 0,
    Lista: 0,
    Documento: "",
    Identificacao: "",
    Nome: "",
    pessoal: {
      Documento: "",
      Nome: "",
      // Inclua outros campos necessários ou deixe-os como string vazia ou null
    },
  });

  const [empresa, setEmpresa] = useState<Empresa>({
    Codigo: 0,
    Empresa: "",
  });

  const [embarcacao, setEmbarcacao] = useState<Embarcacao>({});

  const [loading, setLoading] = useState(false);

  useEffect(() => {
    const token = localStorage.getItem('token');

    const fetchEmbarcacoesETripulantes = async () => {
      try {
        const responseEmbarcacoes = await axios.get(
          "/api/portal/embarcacao/readVessel",
          {
            headers: {
              Authorization: `Bearer ${token}`
            }
          }
        );
        setEmbarcacoes(responseEmbarcacoes.data);
        setEmbarcacoesComboio(responseEmbarcacoes.data);
        const responseTripulantes = await axios.get(
          "/api/portal/tripulantes/readCrew",
          {
            headers: {
              Authorization: `Bearer ${token}`
            }
          }
        );
        setTripulantes(responseTripulantes.data);
        console.error(responseTripulantes.data);
        console.log(lped);
      } catch (error) {
        console.error("Erro ao buscar embarcação ou tripulante.");
      }
    };

    fetchEmbarcacoesETripulantes();
    if (passageiro) {
      setLpeComboios(passageiro.lpecomboio || []);
      setLpeds(passageiro.lped || []);
      setLpe(passageiro);
      fillCompanyAndLpedOnEdit(passageiro);
    } else {
      setLpe({
        Controle: 0,
        Embarcacao: "",
        Companhia_Agente: "",
        embarcacao: {
          Inscricao: "",
          Embarcacao: "",
          Empresa: {
            Codigo: 0,
            Empresa: "",
          },
        },
        Porto_de_chegada_e_partida: "",
        Porto_de_procedencia: "",
        Data_emissao: "",
        Lpe_obs1: "",
        Comandante: "",
      });
    }
  }, [passageiro]);

  const handleLpeChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setLpe((prev) => ({
      ...prev,
      [name]: value,
    }));
  };

  const handleLpeComboioChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setLpeComboio((prev) => ({
      ...prev,
      [name]: value,
    }));
  };

  const handleLpedChange = (e: DropdownChangeEvent) => {
    const { value } = e.target;
    setLoading(true);
    const buscaTripulante = tripulantes.find(
      (tripulante) => tripulante.Documento === value
    );
    if (buscaTripulante) {
      setTripulanteSelecionado(buscaTripulante);
    } else {
      setTripulanteSelecionado(null);
    }
    setLoading(false);
  };

  const [listaPassageirosError, setListaPassageirosError] = useState<{
    [key: string]: boolean;
  }>({});
  const validateFields = () => {
    const newErrors: { [key: string]: boolean } = {};

    if (!lpe.Porto_de_chegada_e_partida) newErrors.Porto_de_chegada_e_partida = true;
    if (!lpe.Porto_de_procedencia) newErrors.Porto_de_procedencia = true;
    if (!lpe.Data_emissao) newErrors.Data_emissao = true;
    if (!lpe.Lpe_obs1) newErrors.Lpe_obs1 = true;
    if (!lpe.Comandante) newErrors.Comandante = true;
    if (!lpe.Embarcacao) newErrors.Embarcacao = true;

    setListaPassageirosError(newErrors);

    return Object.keys(newErrors).length === 0;
  };

  const [error, setError] = useState<string | null>(null);
  const [erroEmbarcacao, setErroEmbarcacao] = useState<string | null>(null);

  const handleAddLped = () => {
    if (!tripulanteSelecionado?.Documento) {
      setError("Tripulante não pode estar vazio!");
      toast.error("Tripulante não pode estar vazio!", {
          autoClose: 2000,
      });
      return; // Retorna para evitar a adição do tripulante
  }
  if (tripulanteSelecionado) {
    // Verifica se o tripulante já está na lista
    const tripulanteJaExiste = lpeds.some(
        (tripulante) => tripulante.pessoal.Documento === tripulanteSelecionado.Documento
    );


      if (tripulanteJaExiste) {
        setError("Tripulante já existente!");
        toast.error("Tripulante já existe, verifique a lista!", {
          autoClose: 2000,
        });
      } else {
        if (passageiro) {
          setError(null);
          setLpedsEdit((prev) => [
            ...prev,
            {
              pessoal: {
                Documento: tripulanteSelecionado.Documento,
                Nome: tripulanteSelecionado.Nome,
                Funcao: tripulanteSelecionado.Funcao,
                Data_de_nascimento: tripulanteSelecionado.Data_de_nascimento,
                Nacionalidade: tripulanteSelecionado.Nacionalidade,
              },
            },
          ]);

          setLpeds((prev) => [
            ...prev,
            {
              pessoal: {
                Documento: tripulanteSelecionado.Documento,
                Nome: tripulanteSelecionado.Nome,
                Funcao: tripulanteSelecionado.Funcao,
                Data_de_nascimento: tripulanteSelecionado.Data_de_nascimento,
                Nacionalidade: tripulanteSelecionado.Nacionalidade,
              },
            },
          ]);
        } else {
          setError(null);
          setLpeds((prev) => [
            ...prev,
            {
              pessoal: {
                Documento: tripulanteSelecionado.Documento,
                Nome: tripulanteSelecionado.Nome,
                Funcao: tripulanteSelecionado.Funcao,
                Data_de_nascimento: tripulanteSelecionado.Data_de_nascimento,
                Nacionalidade: tripulanteSelecionado.Nacionalidade,
              },
            },
          ]);
        }
      }

      setTripulanteSelecionado(null);
    }
  };

  const handleComandanteChange = async (e: any, name: string) => {
    const { value } = e.target;
    setLpe((prevDespacho) => ({
      ...prevDespacho,
      [name]: value,
    }));
  };
  const handleAddLpeComboio = () => {
    if (!embarcacaoSelecionada?.Inscricao) {
      setErroEmbarcacao("Embarcação não pode estar vazia!");
      toast.error("Embarcação não pode estar vazia!", {
        autoClose: 2000,
      });
      return; // Retorna para evitar a adição do item
    }
  
    const embarcacaoExistente = lpeComboios.some(
      (embarcacao) => embarcacao.embarcacao.Inscricao === embarcacaoSelecionada?.Inscricao
    );
  
    if (embarcacaoExistente) {
      setErroEmbarcacao("Embarcação já existente!");
      toast.error("Embarcação já existe, verifique a lista!", {
        autoClose: 2000,
      });
    } else {
      if (passageiro) {
        setErroEmbarcacao(null);

        setLpeComboiosEdit((prev) => [
          ...prev,
          {
            Embarcacao: "",
            Controle: 0, // Defina os valores apropriados ou deixe como undefined se não for necessário
            Lista: 0,
            embarcacao: {
              Inscricao: embarcacaoSelecionada?.Inscricao,
              Embarcacao: embarcacaoSelecionada?.Embarcacao,
              Empresa: embarcacaoSelecionada?.Empresa,
            },
          },
        ]);

        setLpeComboios((prev) => [
          ...prev,
          {
            Embarcacao: "",
            Controle: 0, // Defina os valores apropriados ou deixe como undefined se não for necessário
            Lista: 0,
            embarcacao: {
              Inscricao: embarcacaoSelecionada?.Inscricao,
              Embarcacao: embarcacaoSelecionada?.Embarcacao,
              Empresa: embarcacaoSelecionada?.Empresa,
            },
          },
        ]);
      } else {
        setErroEmbarcacao(null);
        setLpeComboios((prev) => [
          ...prev,
          {
            Embarcacao: "",
            Controle: 0, // Defina os valores apropriados ou deixe como undefined se não for necessário
            Lista: 0,
            embarcacao: {
              Inscricao: embarcacaoSelecionada?.Inscricao,
              Embarcacao: embarcacaoSelecionada?.Embarcacao,
              Empresa: embarcacaoSelecionada?.Empresa,
            },
          },
        ]);
      }
    }
    console.log(lpeComboios);

    setEmbarcacaoSelecionada(null);
  };

  const handleRemoveLped = async (documento: string) => {
    const token = localStorage.getItem('token');

    if (passageiro) {
      const lpedRemocao = lpeds.find((lped) => lped.Documento === documento);

      if (!lpedRemocao) {
        console.log("Lped não encontrado");
        return;
      }

      console.log("Lped encontrado:", lpedRemocao);

      try {
        // Ajuste: Usando data na configuração do axios.delete
        const response = await axios.delete(
          "/api/portal/listaPassageirosLped/deletePassengerListLped",
          {
            data: { Controle: lpedRemocao.Controle },
            headers: {
              Authorization: `Bearer ${token}`
            }
          }
        );

        console.log("Lped deletado com sucesso:", response.data);

        // Atualize o estado após a deleção ser bem-sucedida
        setLpeds((prev) => prev.filter((lped) => lped.Documento !== documento));
        console.log("Lpeds atualizado:", lpeds);
      } catch (error) {
        console.error("Erro ao deletar o Lped:", error);
      }
    }

    setLpeds((prev) => prev.filter((lped) => lped.Documento !== documento));
  };

  const handleRemoveLpeComboio = async (emb: string) => {
    const token = localStorage.getItem('token');

    if (passageiro) {
      // Corrigido: Adicionando return na função find
      const comboioRemocao = lpeComboios.find(
        (comboio) => comboio.Embarcacao === emb
      );

      if (!comboioRemocao) {
        console.log("Comboio não encontrado");
        return;
      }

      console.log("Comboio encontrado:", comboioRemocao);

      try {
        // Ajuste: Usando data na configuração do axios.delete
        const response = await axios.delete(
          "/api/portal/listaPassageirosComboio/deleteTrainPassengerList",
          {
            data: { Controle: comboioRemocao.Controle },
            headers: {
              Authorization: `Bearer ${token}`
            }
          }
        );

        console.log("Comboio deletado com sucesso:", response.data);
        // Atualize o estado ou UI conforme necessário
      } catch (error) {
        console.error("Erro ao deletar comboio:", error);
      }

      // Atualizando o estado local para remover o comboio
      setLpeComboios((prev) =>
        prev.filter((comboio) => comboio.Embarcacao !== emb)
      );
    }

    setLpeComboios((prev) =>
      prev.filter((comboio) => comboio.Embarcacao !== emb)
    );
  };

  const handleEmbarcacaoChange = async (e: any, name: string) => {
    const { value } = e.target;
    setLoading(true);
    const buscaEmbarccao = embarcacoesComboio.find(
      (embarcacoesComboio) => embarcacoesComboio.Inscricao === value
    );
    if (buscaEmbarccao) {
      setEmbarcacaoSelecionada(buscaEmbarccao);
    } else {
      setEmbarcacaoSelecionada(null);
    }
    setLoading(false);
  };

  const fillCompanyAndLpedOnEdit = async (passageiro: LPE) => {
    const token = localStorage.getItem('token');

    try {
      const empresa = await axios.get(
        "/api/portal/empresa/getEmpresaByEmbarcacao",
        {
          params: { inscricao: passageiro.Embarcacao },
          headers: {
            Authorization: `Bearer ${token}`
          }
        }
      );

      setEmbarcacao({
        ...passageiro.embarcacao,
        Inscricao: passageiro.Embarcacao,
      });

      setEmpresa(empresa.data);
    } catch (error) {
      console.error("Algo deu errado ao buscar empresa", error);
    }
  };

  const handleDropdownChange = async (e: any, name: string) => {
    const token = localStorage.getItem('token');

    const { value } = e.target;
    setLpe((prevDespacho) => ({
      ...prevDespacho,
      [name]: value,
    }));

    setLoading(true);

    // Encontra a embarcação com a inscrição correspondente
    const embarcacaoInscricao = embarcacoes.find(
      (embarcacao) => embarcacao.Inscricao === value
    );

    // Define o estado da embarcação encontrada
    if (embarcacaoInscricao) {
      setEmbarcacao(embarcacaoInscricao);
    } else {
      setEmbarcacao({
        Inscricao: "",
        Embarcacao: "",
        Empresa: {
          Codigo: 0,
          Empresa: "",
        },
      });
    }

    try {
      setLoading(true);
      const responseEmpresa = await axios.get(
        `/api/portal/empresa/getEmpresaByEmbarcacao`,
        {
          params: { inscricao: value },
          headers: {
            Authorization: `Bearer ${token}`
          }
        }
      );

      setEmpresa(responseEmpresa.data);
      setLoading(false)
    } catch (error) {
      console.error("Erro ao buscar as entidades relacionadas:", error);
    }
    setLoading(false);
  };

  const [loadingSubmit, setLoadingSubmit] = useState(false);

  const handleSubmit = async () => {
    if (!validateFields()) {
      return toast.error("Por favor, preencha todos os campos obrigatórios.");
    } else {
      const token = localStorage.getItem("token");

      if (passageiro) {
        try {
          // Encontrar a embarcação correspondente
          const embarcacaoUpdate = embarcacoes.find(
            (embarc) => embarc.Inscricao === lpe.Embarcacao
          );

          if (!embarcacaoUpdate) {
            toast.error("Embarcação não encontrada");
            return;
          }

          // Remover o campo Embarcacao do lpe e adicionar embarcacaoUpdate
          const { Embarcacao, ...lpeSemEmbarcacao } = lpe;

          // Enviar a solicitação PUT para a API
          const lpeResponse = await axios.put(
            "/api/portal/listaPassageiros/updatePassengerList",
            {
              ...lpeSemEmbarcacao,
              embarcacao: embarcacaoUpdate,
              Controle: passageiro.Controle,
            },
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          for (const lpeComboioItem of lpeComboiosEdit) {
            const { Controle, ...lpeComboioSemControle } = lpeComboioItem;
            await axios.post(
              "/api/portal/listaPassageirosComboio/createTrainPassengerList",
              {
                ...lpeComboioSemControle,
                Lista: lpeResponse.data.Controle,
              },
              {
                headers: { Authorization: `Bearer ${token}` },
              }
            );
          }

          for (const lpedItem of lpedsEdit) {
            const { Controle, ...lpedSemControle } = lpedItem;
            await axios.post(
              "/api/portal/listaPassageirosLped/createPassengerListLped",
              {
                ...lpedSemControle,
                Lista: lpeResponse.data.Controle,
              },
              {
                headers: { Authorization: `Bearer ${token}` },
              }
            );
          }
          onSuccess();

          window.location.reload();
        } catch (error) {
          toast.error("Erro ao atualizar os dados:");
        }
      } else {
        setLoadingSubmit(true);
        try {
          const { Controle, ...lpeSemControle } = lpe;
          const lpeResponse = await axios.post(
            "/api/portal/listaPassageiros/createPassengerList",
            {
              ...lpeSemControle,
              Embarcacao: lpe.Embarcacao,
            },
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );

          for (const lpeComboioItem of lpeComboios) {
            const { Controle, Lista, ...lpeComboioSemControle } = lpeComboioItem;
            await axios.post(
              "/api/portal/listaPassageirosComboio/createTrainPassengerList",
              {
                ...lpeComboioSemControle,
                ListaLpe: lpeResponse.data.Controle,
              },
              {
                headers: { Authorization: `Bearer ${token}` },
              }
            );
          }

          for (const lpedItem of lpeds) {
            const { Controle, ...lpedSemControle } = lpedItem;
            await axios.post(
              "/api/portal/listaPassageirosLped/createPassengerListLped",
              {
                ...lpedSemControle,
                Lista: lpeResponse.data.Controle,
              },
              {
                headers: { Authorization: `Bearer ${token}` },
              }
            );
          }
          setLoadingSubmit(false);
          toast.success("Atualizado com sucesso!");
          onClose();
          window.location.reload();
        } catch (error) {
          toast.error("Erro ao cadastrar dados:");
        }
      }
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setLpe((prevLpe) => ({
      ...prevLpe,
      [name]: value,
    }));
  };

  const renderIconLped = (rowData: any) => {
    return (
      <i
        className={`pi pi-trash ${styles["icon-bold"]}`}
        onClick={() => handleRemoveLped(rowData.Documento)}
      ></i>
    );
  };

  const renderIconComboio = (rowData: any) => {
    return (
      <i
        className={`pi pi-trash ${styles["icon-bold"]}`}
        onClick={() => handleRemoveLpeComboio(rowData.Embarcacao)}
      ></i>
    );
  };

  const [visible, setVisible] = useState(false);

  const footerContent = (
    <div className={styles.botao}>
      <p>ola</p>
      {/* <ButtonCustom tipoBotao='cancelar' title="Não" tamanho="10em" onClick={onClose} />
        <ButtonCustom tipoBotao='normal' title="Sim" onClick={logout} tamanho="10em" /> */}
    </div>
  );

  return (
    <>

      <Dialog
        visible={true}
        closable={false}
        onHide={onClose}
        headerClassName={styles.modal}
        contentClassName={styles.modal}
      >

        <div className={styles.form}>
          <div className={styles.title}>
            <Image src={ListaPassageirosIcon} alt={""}></Image>
            {passageiro ? (
              <a>Editar Lista de Tripulantes</a>
            ) : (
              <a>Nova Lista de Tripulantes</a>
            )}
          </div>
          {/* INFORMACOES */}
          <div className={styles.informacoes}>
            <div className={styles.containerLinha}>
              <div className={styles.linha}></div>
              <div className={styles.texto}>Informações</div>
              <div className={styles.linha}></div>
            </div>

            {/* EMBARCACAO E INSCRICAO */}
            <div className={styles.embarcacaoInscricao}>
              <div className={styles.opcao}>
                <a>Embarcação:</a>
                <Dropdown
                  placeholder="Selecione a Embarcação"
                  id="embarcacaoDropDown"
                  name="embarcacao"
                  optionLabel="Embarcacao"
                  optionValue="Inscricao"
                  value={lpe.Embarcacao}
                  options={embarcacoes}
                  className={`${styles.inputText} ${listaPassageirosError.Embarcacao ? styles.error : ""
                    }`}
                  onChange={(e) => handleDropdownChange(e, "Embarcacao")}
                />
              </div>
              <div className={styles.opcao}>
                <a>Inscrição:</a>
                <InputText
                  id="inscricao"
                  name="Inscricao"
                  value={embarcacao.Inscricao}
                  className={styles.inputText}
                  onChange={handleChange}
                  disabled
                />
              </div>
            </div>
            {/* EMPRESA */}
            <div className={styles.opcao}>
              <a>Empresa:</a>
              <InputText
                id="empresa"
                name="Empresa"
                value={empresa.Empresa}
                className={styles.inputText}
                disabled
              />{" "}
              {loading ? (
                <div className={styles["spinner-container"]}>
                  <ProgressSpinner
                    style={{ width: "20px", height: "20px" }}
                    strokeWidth="8"
                    fill="var(--surface-ground)"
                    animationDuration=".5s"
                  />
                </div>
              ) : (
                ""
              )}
            </div>
          </div>

          {/* ESPECIFICACOES */}
          <div className={styles.informacoes}>
            <div className={styles.containerLinha}>
              <div className={styles.linha}></div>
              <div className={styles.texto}>Especificações</div>
              <div className={styles.linha}></div>
            </div>

            <div className={styles.opcao}>
              <a>Porto de Chegada e Partida:</a>
              <InputText
                name="Porto_de_chegada_e_partida"
                value={lpe.Porto_de_chegada_e_partida}
                className={`${styles.inputText} ${listaPassageirosError.Porto_de_chegada_e_partida
                  ? styles.error
                  : ""
                  }`}
                onChange={handleLpeChange}
              />
            </div>

            <div className={styles.portoProcedenciaDataEmissao}>
              <div className={styles.opcao}>
                <a>Porto de Procedência:</a>
                <InputText
                  name="Porto_de_procedencia"
                  value={lpe.Porto_de_procedencia}
                  className={`${styles.inputText} ${listaPassageirosError.Porto_de_procedencia ? styles.error : ""
                    }`}
                  onChange={handleLpeChange}
                />
              </div>
              <div className={styles.opcao}>
                <a>Data de Emissão:</a>
                <InputText
                  name="Data_emissao"
                  value={lpe.Data_emissao}
                  className={`${styles.inputText} ${listaPassageirosError.Data_emissao ? styles.error : ""
                    }`}
                  onChange={handleLpeChange}
                />
              </div>
            </div>

            <div className={styles.opcao}>
              <a>Observações:</a>
              <InputText
                name="Lpe_obs1"
                value={lpe.Lpe_obs1}
                className={`${styles.inputText} ${listaPassageirosError.Lpe_obs1 ? styles.error : ""
                  }`}
                onChange={handleLpeChange}
              />
            </div>
          </div>
          {/* TRIPULANTES */}
          <div className={styles.informacoes}>
            <div className={styles.containerLinha}>
              <div className={styles.linha}></div>
              <div className={styles.texto}>Tripulantes</div>
              <div className={styles.linha}></div>
            </div>

            <div className={styles.opcao}>
              <a>Comandante:</a>
              <Dropdown
                placeholder="Selecione o Comandante"
                id="comandanteDropDown"
                name="Despacho_comandante"
                optionLabel="Nome"
                optionValue="Nome"
                value={lpe.Comandante}
                options={tripulantes}
                className={`${styles.inputText} ${listaPassageirosError.Comandante ? styles.error : ""
                  }`}
                onChange={(e) =>
                  handleComandanteChange(e, "Comandante")
                }
              />
            </div>
            <div className={styles.tripulanteButton}>
              <div className={styles.opcao}>
                <a>Tripulantes:</a>
                <Dropdown
                  name="Tripulante"
                  value={tripulanteSelecionado?.Documento || ""}
                  options={tripulantes.map((tripulante) => ({
                    label: `${tripulante.Nome}`,
                    value: tripulante.Documento,
                  }))}
                  className={styles.inputText}
                  onChange={handleLpedChange}
                />
                {error && <div className={styles.errorMessage}>{error}</div>}
              </div>
              <Button
                tipoBotao="cinza"
                icon=" pi pi-plus-circle"
                title="Adicionar"
                onClick={handleAddLped}
                tamanho="100%"
                altura="2em"
              />
            </div>

            {lpeds && (
              <div className={styles.listaTripulantes}>
                {lpeds.length > 0 ? (
                  <DataTable
                    value={lpeds}
                    showGridlines={true}
                    tableStyle={{ maxWidth: "49em" }}
                    className={`${styles.tabela} ${styles["rounded-datatable"]}`}
                  >
                    <Column
                      headerClassName={styles.firstHeader}
                      bodyStyle={{
                        border: "none",
                        font: "10px",
                        padding: "0 0.25em 0 0",
                        height: "auto",
                      }}
                      body={(rowData, { rowIndex }) => (
                        <InputText
                          value={rowData.pessoal.Documento}
                          className={styles.inputTableTripulantes}
                          disabled
                        />
                      )}
                    />
                    <Column
                      body={(rowData, options) => (
                        <InputText
                          value={rowData.pessoal.Nome}
                          className={styles.inputTableTripulantes}
                          disabled
                        />
                      )}
                      headerClassName={styles.firstHeader}
                      bodyStyle={{
                        border: "none",
                        font: "10px",
                        padding: "0 0.25em 0 0.25em",
                        height: "auto",
                      }}
                    />
                    <Column
                      body={(rowData, options) => (
                        <InputText
                          value={rowData.pessoal.Funcao}
                          className={styles.inputTableTripulantes}
                          disabled
                        />
                      )}
                      headerClassName={styles.firstHeader}
                      bodyStyle={{
                        border: "none",
                        font: "10px",
                        padding: "0 0.25em 0 0.25em",
                        height: "auto",
                      }}
                    />
                    <Column
                      body={(rowData, options) => (
                        <InputText
                          value={rowData.pessoal.Data_de_nascimento}
                          className={styles.inputTableTripulantes}
                          disabled
                        />
                      )}
                      headerClassName={styles.firstHeader}
                      bodyStyle={{
                        border: "none",
                        font: "10px",
                        padding: "0 0.25em 0 0.25em",
                        height: "auto",
                      }}
                    />
                    <Column
                      body={(rowData, options) => (
                        <InputText
                          value={rowData.pessoal.Nacionalidade}
                          className={styles.inputTableTripulantes}
                          disabled
                        />
                      )}
                      headerClassName={styles.firstHeader}
                      bodyStyle={{
                        border: "none",
                        font: "10px",
                        padding: "0 0.25em 0 0.25em",
                        height: "auto",
                      }}
                    />
                    <Column
                      body={renderIconLped}
                      bodyStyle={{
                        border: "none",
                        font: "10px",
                        padding: "0 0 0 0.25em",
                        height: "auto",
                      }}
                      headerStyle={{
                        textAlign: "left",
                        alignContent: "center",
                        backgroundColor: "white",
                        width: "4em",
                        color: "black",
                        border: "none",
                      }}
                    />
                  </DataTable>
                ) : (
                  ""
                )}
              </div>
            )}

            {/* LISTAS */}

            {/* <div className={styles.listaComboios}>
            {lpeComboios.map((comboio, index) => (
              <div key={index} className={styles.comboio}>
                <span>{`Comboio ${index + 1}: ${comboio.Embarcacao}`}</span>
                <button onClick={() => handleRemoveLpeComboio(index)}>Remover</button>
              </div>
            ))}
          </div> */}
          </div>
          <div className={styles.informacoes}>
            <div className={styles.containerLinha}>
              <div className={styles.linha}></div>
              <div className={styles.texto}>Comboio</div>
              <div className={styles.linha}></div>
            </div>

            <div className={styles.tripulanteButton}>
              <div className={styles.opcao}>
                <a>Embarcação:</a>
                <Dropdown
                  value={embarcacaoSelecionada?.Inscricao}
                  options={embarcacoesComboio}
                  optionLabel="Embarcacao"
                  optionValue="Inscricao"
                  className={styles.inputText}
                  onChange={(e) => handleEmbarcacaoChange(e, "embarcacao")}
                />
                {erroEmbarcacao && (
                  <div className={styles.errorMessage}>{erroEmbarcacao}</div>
                )}
              </div>
              {/* <div className={styles.opcao}>
              <a>Embarcação:</a>
              <InputText
                name="Embarcacao"
                value={lpeComboio.Embarcacao}
                className={styles.inputText}
                onChange={handleLpeComboioChange} />
            </div> */}
              <div className={styles.opcao}>
                <Button
                  tipoBotao="cinza"
                  icon=" pi pi-plus-circle"
                  title="Adicionar Comboio"
                  onClick={handleAddLpeComboio}
                  tamanho="100%"
                  altura="2em"

                />
              </div>
            </div>

            {/* LISTA DE COMBOIO */}

            <div className={styles.listaComboios}>
              {lpeComboios.length > 0 ? (
                <DataTable
                  value={lpeComboios}
                  showGridlines={true}
                  tableStyle={{ maxWidth: "49em" }}
                  className={`${styles.tabela} ${styles["rounded-datatable"]}`}
                >
                  <Column
                    headerClassName={styles.firstHeader}
                    bodyStyle={{
                      border: "none",
                      maxWidth: "3em",
                      font: "10px",
                      padding: "0 0.25em 0 0",
                      height: "auto",
                    }}
                    body={(rowData, { rowIndex }) => (
                      <InputText
                        value={rowData.embarcacao.Inscricao}
                        className={styles.inputTableTripulantes}
                        disabled
                      />
                    )}
                  />
                  <Column
                    body={(rowData, options) => (
                      <InputText
                        value={rowData.embarcacao.Embarcacao}
                        className={styles.inputTableTripulantes}
                        disabled
                      />
                    )}
                    headerClassName={styles.firstHeader}
                    bodyStyle={{
                      border: "none",
                      font: "10px",
                      padding: "0 0.25em 0 0.25em",
                      height: "auto",
                    }}
                    headerStyle={{ maxWidth: "7em", height: "0.5em" }}
                  />

                  <Column
                    body={renderIconComboio}
                    bodyStyle={{
                      border: "none",
                      font: "10px",
                      padding: "0 0 0 0.25em",
                      height: "auto",
                      textAlign: "right",
                      alignContent: "right",
                    }}
                    headerStyle={{
                      textAlign: "right",
                      alignContent: "right",
                      backgroundColor: "white",
                      width: "1em",
                      color: "black",
                      border: "none",
                      height: "0.5em",
                    }}
                  />
                </DataTable>
              ) : (
                ""
              )}
            </div>
          </div>

          <div className={styles.botoes}>
            <PrimeButton
              tipoBotao="cancelar"
              title="Cancelar"
              onClick={onClose}
              tamanho="10em"
            />
            {loadingSubmit == true ? <PrimeButton
              tipoBotao="normal"
              title={

                <ProgressSpinner
                  style={{ width: "20px", height: "20px" }}
                  strokeWidth="8"
                  animationDuration=".5s"
                />
              }

              tamanho="10em"
            /> :
              <PrimeButton
                tipoBotao="normal"
                title={embarcacao ? "Salvar" : "Atualizar"}
                onClick={handleSubmit}
                tamanho="10em"
              />}

          </div>
        </div>
      </Dialog>
    </>
  );
};

export default ModalCadastroEdicao;